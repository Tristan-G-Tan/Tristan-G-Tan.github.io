<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Zalgo Text Generator</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
        body {
            font-family: system-ui, Arial, sans-serif;
            padding: 18px;
            max-width: 900px;
            margin: auto;
        }

        /* field-sizing only works on Chrome and Edge, not Firefox and Safari.
    https://stackoverflow.com/questions/454202/creating-a-textarea-with-auto-resize */
        textarea {
            font-family: system-ui, Arial, sans-serif;
            resize: none;
            /* field-sizing: content; */
            overflow-y: hidden;
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #ddd;
            min-height: 34px;
            font-size: 18px;
            word-break: break-word;
            background: #fafafa;
        }

        .block {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0 24px;
        }

        .out {
            flex: 1;
            white-space: pre-wrap;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #ddd;
            min-height: 34px;
            display: flex;
            align-items: center;
            font-size: 18px;
            word-break: break-word;
            background: #fafafa;
        }

        button.copy {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid #bbb;
            background: white;
            cursor: pointer;
        }

        h2 {
            font-size: 16px;
            margin: 6px 0 6px;
            display: block;
            font-weight: 700;
        }

        .meta {
            color: #666;
            font-size: 13px;
            margin-bottom: 6px;
        }

        footer {
            margin-top: 30px;
            color: #666;
            font-size: 13px;
        }
    </style>
</head>

<body>

    <h1>Zalgo Text Generator</h1>
    <p class="meta">Type in the box below. The creepy, scary-looking zalgo text is generated by stacking a whole bunch
        of
        combining unicode characters.</p>
    <div>
        <h2>Settings (see <a href="https://en.wikipedia.org/wiki/Combining_character#Unicode_ranges">Wikipedia</a> for more information):</h2>
        <label for="craziness" title="Number of diacritical marks added onto each character">Craziness level:</label>
        <input type="number" id="craziness" value="10" min="1" max="10000">
        <br>
        
        <input type="checkbox" id="block1" oninput="getDiacritics();" checked>
        <label for="block1" title="Use the characters in this unicode block?">Combining Diacritical Marks</label>
        <br>

        <input type="checkbox" id="block2" oninput="getDiacritics();">
        <label for="block2" title="Use the characters in this unicode block?">Combining Diacritical Marks
            Extended (Hardly ever supported)</label>
        <br>

        <input type="checkbox" id="block3" oninput="getDiacritics();" checked>
        <label for="block3" title="Use the characters in this unicode block?">Combining Diacritical Marks
            Supplement</label>
        <br>

        <input type="checkbox" id="block4" oninput="getDiacritics();">
        <label for="block4" title="Use the characters in this unicode block?">Combining Diacritical Marks for
            Symbols (supported on WeChat)</label>
        <br>

        <input type="checkbox" id="block5" oninput="getDiacritics();">
        <label for="block5" title="Use the characters in this unicode block?">Combining Half Marks (supported on
            WeChat)</label>
    </div>

    <h2>Type in here:</h2>
    <button class="copy" onclick="selectAll();">select all</button>
    <button class="copy" id="copyInput">copy</button>
    <button class="copy" onclick="paste();">paste</button>
    <button class="copy" onclick="undo();">undo</button>
    <textarea id="source" title="Input"></textarea>
    <div class="block-container">
        <h2>Output</h2>
        <div class="block">
            <textarea class="out" id="out"></textarea>
            <button class="copy" type="button" id="copyOutput" onclick="copy();">copy to
                clipboard</button>
        </div>
    </div>

    <footer>
        <p>
            Alternatively, try typing in the "output" box to unzalgo the text back into clean, regular text.
        </p>
        <p>
            The "Paste" button first asks for permission to access your clipboard. If access is denied, it instead
            pastes the
            last
            thing this website copied.
        </p>
        <p>
            <a href="https://tristan-g-tan.github.io/">Click to return to main page</a>.
        </p>
    </footer>

    <script>
        const up = [
            "̍",
            "̎",
            "̄",
            "̅",
            "̿",
            "̑",
            "̆",
            "̐",
            "͒",
            "͗",
            "͑",
            "̇",
            "̈",
            "̊",
            "͂",
            "̓",
            "̈́",
            "͊",
            "͋",
            "͌",
            "̃",
            "̂",
            "̌",
            "͐",
            "̀",
            "́",
            "̋",
            "̏",
            "̒",
            "̓",
            "̔",
            "̽",
            "̉",
            "ͣ",
            "ͤ",
            "ͥ",
            "ͦ",
            "ͧ",
            "ͨ",
            "ͩ",
            "ͪ",
            "ͫ",
            "ͬ",
            "ͭ",
            "ͮ",
            "ͯ",
            "̾",
            "͛",
            "͆",
            "̚",
            "̕",
            "̛",
            "̀",
            "́",
            "͘",
            "͝",
            "͠",
            "͡"
        ];
        const down = [
            "̖",
            "̗",
            "̘",
            "̙",
            "̜",
            "̝",
            "̞",
            "̟",
            "̠",
            "̤",
            "̥",
            "̦",
            "̩",
            "̪",
            "̫",
            "̬",
            "̭",
            "̮",
            "̯",
            "̰",
            "̱",
            "̲",
            "̳",
            "̹",
            "̺",
            "̻",
            "̼",
            "ͅ",
            "͇",
            "͈",
            "͉",
            "͍",
            "͎",
            "͓",
            "͔",
            "͕",
            "͖",
            "͙",
            "͚",
            "̣",
            "̡",
            "̢",
            "̧",
            "̨",
            "͜",
            "͟"
        ];
        const mid = [
            "̴",
            "̵",
            "̶",
            "̷",
            "̸"
        ];
        let zalgo;
        function getDiacritics() {
            zalgo = [];
            // Combining Diacritical Marks
            if (block1.checked)
                for (let i = 0x300; i < 0x370; i++) {
                    if (i === 0x34F) continue; // invisible Combining Grapheme Joiner
                    zalgo.push(i);
                }
            // Combining Diacritical Marks Extended (not supported on most devices)
            if (block2.checked)
                for (let i = 0x1AB0; i < 0x1AEC; i++) {
                    zalgo.push(i);
                }
            // Combining Diacritical Marks Supplement
            if (block3.checked) {
                for (let i = 0x1DC0; i < 0x1DCB; i++) {
                    zalgo.push(i);
                }
                zalgo.push(0x1DFE, 0x1DFF);
            }
            // Combining Diacritical Marks for Symbols (supported on WeChat, not everywhere)
            if (block4.checked)
                for (let i = 0x20D0; i < 0x20F1; i++) {
                    zalgo.push(i);
                }
            // Combining Half Marks (supported on WeChat, not everywhere)
            if (block5.checked)
                for (let i = 0xFE20; i < 0xFE27; i++) {
                    zalgo.push(i);
                }
        }
        getDiacritics();

        function transformString(s) {
            let count = ~~Number(craziness.value) || 10;
            if (count < 1) count = 1;
            if (count > 10000) count = 10000;
            let out = [];
            let i = 0;
            for (const ch of Array.from(s)) {
                out.push(ch.codePointAt(0));
                for (let i = 0; i < count; i++) {
                    out.push(zalgo[Math.trunc(Math.random() * zalgo.length)]);
                }
                i++;
            }
            // return out.join("");
            return String.fromCodePoint(...out);
        }

        let copyInput = document.getElementById("copyInput");
        copyInput.onclick = async () => {
            virtual_clipboard = input.value;
            try {
                await navigator.clipboard.writeText(input.value);
                copyInput.textContent = 'copied!';
                setTimeout(() => copyInput.textContent = 'copy', 1000);
            } catch (e) {
                // fallback method
                try {
                    const ta = document.createElement('textarea');
                    ta.value = input.value;
                    document.body.appendChild(ta);
                    ta.select();
                    document.execCommand('copy');
                    document.body.removeChild(ta);
                    copyInput.textContent = 'copied!';
                    setTimeout(() => copyInput.textContent = 'copy', 1000);
                } catch (err) {
                    alert('Copy failed: ' + (err && err.message ? err.message : err));
                }
            }
        };

        let virtual_clipboard;
        const undoStack = [];
        // Update outputs from input
        const input = document.getElementById('source');
        const craziness = document.getElementById('craziness');
        const out = document.getElementById("out");
        function updateZalgo() {
            const text = input.value || '';
            undoStack.push(text);
            out.value = transformString(text);
            input.style.height = 'auto';
            input.style.height = input.scrollHeight + 'px';
        }
        function unZalgo() {
            const text = out.value || '';
            input.value = text.replace(/[\u0300-\u036f\u1ab0-\u1aff\u1dc0-\u1dff\u20d0-\u20ff\ufe20-\ufe2f]/g, '');
            out.style.height = 'auto';
            out.style.height = out.scrollHeight + 'px';
        }
        craziness.oninput = updateZalgo;
        input.oninput = updateZalgo;
        out.oninput = unZalgo;

        function selectAll() {
            input.focus();
            input.select();
        }

        function undo() {
            if (undoStack.length > 1) {
                undoStack.pop(); // remove current state
                input.value = undoStack.pop(); // revert to previous
                input.dispatchEvent(new Event('input')); // trigger any updates
            }
        }

        const copy = async () => {
            virtual_clipboard = out.value;
            try {
                await navigator.clipboard.writeText(out.value);
                copyOutput.textContent = 'copied!';
                setTimeout(() => copyOutput.textContent = 'copy to clipboard', 1000);
            } catch (e) {
                // fallback method
                try {
                    const ta = document.createElement('textarea');
                    ta.value = out.value;
                    document.body.appendChild(ta);
                    ta.select();
                    document.execCommand('copy');
                    document.body.removeChild(ta);
                    copyOutput.textContent = 'copied!';
                    setTimeout(() => copyOutput.textContent = 'copy to clipboard', 1000);
                } catch (err) {
                    alert('Copy failed: ' + (err && err.message ? err.message : err));
                }
            }
        };

        const paste = async () => {
            let text;
            try {
                text = await navigator.clipboard.readText(); // read clipboard
            } catch (err) {
                // alert('Clipboard access denied. Try granting permission or pasting manually.');
                // text = "";
                // Note: HUAWEI browser ALWAYS denies pasting permission. Use our virtual_clipboard variable instead.
                text = virtual_clipboard || "";
            }
            input.setRangeText(text, input.selectionStart, input.selectionEnd, 'end');
            input.dispatchEvent(new Event('input')); // update height etc.
        };
    </script>
</body>

</html>